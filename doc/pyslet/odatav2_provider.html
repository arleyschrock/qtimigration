<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>2.1.2. OData Providers &mdash; Pyslet 0.4.20140511 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.4.20140511',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="Pyslet 0.4.20140511 documentation" href="index.html" />
    <link rel="up" title="2.1. The Open Data Protocol (OData)" href="odatav2.html" />
    <link rel="next" title="2.1.2.1. Sample Project: InMemory Data Service" href="odatav2_memexample.html" />
    <link rel="prev" title="2.1.1. Data Consumers" href="odatav2_consumer.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="odatav2_memexample.html" title="2.1.2.1. Sample Project: InMemory Data Service"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="odatav2_consumer.html" title="2.1.1. Data Consumers"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">Pyslet 0.4.20140511 documentation</a> &raquo;</li>
          <li><a href="general.html" >2. Supporting Standards</a> &raquo;</li>
          <li><a href="odatav2.html" accesskey="U">2.1. The Open Data Protocol (OData)</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="odata-providers">
<h1>2.1.2. OData Providers<a class="headerlink" href="#odata-providers" title="Permalink to this headline">¶</a></h1>
<p>The approach to writing a data access layer (DAL) taken by Pyslet is to
use the Entity Data Model (EDM), and the extensions defined by OData,
and to encapsulate them in an API defined by a set of abstract Python
classes.  The <a class="reference internal" href="odatav2_consumer.html"><em>Data Consumers</em></a> section goes through this API from
the point of view of the consumer and provides a good primer for
understanding what is required from a provider.</p>
<p>Pyslet includes three derived classes that implement the API in a
variety of different storage scenarios:</p>
<ol class="arabic simple">
<li>OData Client - an implementation of the DAL that makes calls over
the web to an OData server.  Defined in the module
<tt class="xref py py-mod docutils literal"><span class="pre">pyslet.odatav2.client</span></tt> and used in the examples in
the section <a class="reference internal" href="odatav2_consumer.html"><em>Data Consumers</em></a>.</li>
<li>In-memory data service - an implementation of the DAL that stores
all entities and associations in python dictionaries.  Defined in
the module <tt class="xref py py-mod docutils literal"><span class="pre">pyslet.odatav2.memds</span></tt>.</li>
<li>SQL data service - an implementation of the DAL that maps on to
python&#8217;s database API.  Defined in the module
<tt class="xref py py-mod docutils literal"><span class="pre">pyslet.odatav2.sqlds</span></tt>.  In practice, the classes defined
by this module will normally need to be sub-classed to deal with
database-specific issues but a full implementation for SQLite is
provided and a quick look at the source code for that should give
you courage to tackle any modifications necessary for your favourite
database. Using this DAL API is much easier than having to do these
tweaks when they are distributed throughout your code in embedded
SQL-statements.</li>
</ol>
<p>A high-level plan for writing an OData provider would therefore be:</p>
<ol class="arabic simple" start="0">
<li>Identify the underlying DAL class that is most suited to your needs
or, if there isn&#8217;t one, create a new DAL implementation using the
existing implementations as a guide.</li>
<li>Create a metadata document to describe your data model</li>
<li>Write a test program that uses the DAL classes directly to validate
that your model and the DAL implementation are working correctly</li>
<li>Create <tt class="xref py py-class docutils literal"><span class="pre">pyslet.odata2.server.Server</span></tt> that is bound to your
model test it with an OData client to ensure that it works as
expected.</li>
<li>Finally, create a sub-class of the server with any specific
customisations needed by your application: mainly to implement your
applications authentication and authorization model.  (For a
read-only service there may be nothing to do here.)</li>
</ol>
<p>Of course, if all you want to do is use these interfaces as a DAL in
your own application you can stop at item 3 above.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="odatav2_memexample.html">2.1.2.1. Sample Project: InMemory Data Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="odatav2_memexample.html#step-1-creating-the-metadata-model">2.1.2.1.1. Step 1: Creating the Metadata Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="odatav2_memexample.html#step-2-test-the-model">2.1.2.1.2. Step 2: Test the Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="odatav2_memexample.html#step-4-link-the-data-source-to-the-odata-server">2.1.2.1.3. Step 4: Link the Data Source to the OData Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="odatav2_memexample.html#step-5-customise-the-server">2.1.2.1.4. Step 5: Customise the Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="odatav2_memexample.html#conclusion">2.1.2.1.5. Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="odatav2_sqlexample.html">2.1.2.2. A SQL-Backed Data Service</a><ul>
<li class="toctree-l2"><a class="reference internal" href="odatav2_sqlexample.html#step-1-creating-the-metadata-model">2.1.2.2.1. Step 1: Creating the Metadata Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="odatav2_sqlexample.html#step-2-test-the-model">2.1.2.2.2. Step 2: Test the Model</a></li>
<li class="toctree-l2"><a class="reference internal" href="odatav2_sqlexample.html#step-4-link-the-data-source-to-the-odata-server">2.1.2.2.3. Step 4: Link the Data Source to the OData Server</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="odatav2_customexample.html">2.1.2.3. Sample Project: Custom Data Service</a></li>
</ul>
</div>
<div class="section" id="which-dal-implementation">
<h2>2.1.2.4. Which DAL Implementation?<a class="headerlink" href="#which-dal-implementation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="transient-data">
<h3>2.1.2.4.1. Transient Data<a class="headerlink" href="#transient-data" title="Permalink to this headline">¶</a></h3>
<p>If your data is relatively small and transient then you could use the in
memory implementation of the DAL API directly.  This is the easiest
route to creating a new OData provider as you won&#8217;t need to override any
of of the implementations.</p>
<p>Look at the example project <a class="reference internal" href="odatav2_memexample.html"><em>Sample Project: InMemory Data Service</em></a> to see how easy it
is to create a useful in-memory key-value store.</p>
</div>
<div class="section" id="sql">
<h3>2.1.2.4.2. SQL<a class="headerlink" href="#sql" title="Permalink to this headline">¶</a></h3>
<p>If your data is currently in a SQL database, or if you intend to write a
read-only data source and you could easily put your data into a SQL
database, then you should use the Python DB ABI-based implementation as
a starting point.</p>
<p>If your data is in a database other than a SQLite database you will have
to provide a few tweaks by deriving a new class from
<a class="reference internal" href="odatav2_sqlds.html#pyslet.odata2.sqlds.SQLEntityContainer" title="pyslet.odata2.sqlds.SQLEntityContainer"><tt class="xref py py-class docutils literal"><span class="pre">SQLEntityContainer</span></tt></a>.  This can&#8217;t be helped,
the DB API does a good job at dealing with most issues, such as
variation in parameterization conventions and expected data types, but
SQL connection parameters and the occasional differences in the SQL
syntax mean there is likely to be a small amount of work to do.</p>
<p>A look at the customisations required for
<a class="reference internal" href="odatav2_sqlds.html#pyslet.odata2.sqlds.SQLiteEntityContainer" title="pyslet.odata2.sqlds.SQLiteEntityContainer"><tt class="xref py py-class docutils literal"><span class="pre">SQLiteEntityContainer</span></tt></a> where a handful of
methods have had to be overridden should point the way.  You may want to
override the default
<a class="reference internal" href="odatav2_sqlds.html#pyslet.odata2.sqlds.SQLEntityCollection" title="pyslet.odata2.sqlds.SQLEntityCollection"><tt class="xref py py-class docutils literal"><span class="pre">SQLEntityCollection</span></tt></a> object too where
functions and operators from the the expression language can be mapped
on to parameterized SQL queries.</p>
<p>Once you have a class that can connect to your chosen database move on to
<a class="reference internal" href="odatav2_sqlexample.html"><em>A SQL-Backed Data Service</em></a>.</p>
</div>
<div class="section" id="customer-provider">
<h3>2.1.2.4.3. Customer Provider<a class="headerlink" href="#customer-provider" title="Permalink to this headline">¶</a></h3>
<p>Writing a customer provider isn&#8217;t as hard as you might think, provided
your data set is of a mangeable size then you can use the built-in
behaviour of the base classes to take care of almost all the API&#8217;s
needs.  You just need to expose the entity values themselves by
implementing a couple of methods!</p>
<p>Look at the example project <a class="reference internal" href="odatav2_customexample.html"><em>Sample Project: Custom Data Service</em></a> to see how you
can write a simple application that exposes a download-directory to the
web using OData (providing a little more metadata than is easily
obtainable from plain HTTP.)</p>
</div>
<div class="section" id="an-odata-proxy">
<h3>2.1.2.4.4. An OData Proxy<a class="headerlink" href="#an-odata-proxy" title="Permalink to this headline">¶</a></h3>
<p>Finally, the OData client implementation of the DAL API opens the
possibility of writing an OData proxy server.  Why would you do this?</p>
<p>One of the big challenges for the OData protocol is web-security in the
end user&#8217;s browser.   By supporting JSON over the wire OData sends out a
clear signal that using it directly from a Javascript on a web page
should be possible.  But in practice, this only works well for
unauthenticated (and hence read-only) OData services.  If you want to
write more exciting applications you leave yourself open to all manner
of browser-based attacks that could expose your data to unauthorised bad
guys.  To mitigate these risks browsers are increasingly locking down
the browser to make it harder for cross-site exploits to happen, which
is a good thing. The downside is that it makes it harder for your
web-application to talk to an OData server unless they are both hosted
on the same domain.</p>
<p>An OData proxy can be co-located with your application to overcome this
problem.  A dumb proxy is probably best implemented by the web-server,
rather than a full-blown web application but the classes defined in this
package are a good starting point for writing a more intelligent proxy
such as one that checks for a valid session with your application before
proxying the request.</p>
<p>The implementation isn&#8217;t trivial because the identities of the entities
created by the client (as reported by
<tt class="xref py py-meth docutils literal"><span class="pre">GetLocation()</span></tt>) are the URLs of the
entities as they appear in the remote data service whereas the OData
proxy needs to serve up entities with identities with URLs that appear
under its service root.  As a result, you need to create a copy of the
client&#8217;s model and implement proxy classes that implement the API by
pulling and pushing entities into the client.  This isn&#8217;t as much work
as it sounds and you probably want to do it anyway so that your proxy
can add value, such as hiding parts of the model that shouldn&#8217;t be
proxied, adding constraints for authorisation, etc.</p>
<p>I&#8217;m the process of developing a set of proxy classes to act as a good
starting point for this type of application.  Watch this space, or reach
out to me via the <a class="reference external" href="https://code.google.com/p/qtimigration/">Pyslet home page</a>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">2.1.2. OData Providers</a><ul>
<li><a class="reference internal" href="#which-dal-implementation">2.1.2.4. Which DAL Implementation?</a><ul>
<li><a class="reference internal" href="#transient-data">2.1.2.4.1. Transient Data</a></li>
<li><a class="reference internal" href="#sql">2.1.2.4.2. SQL</a></li>
<li><a class="reference internal" href="#customer-provider">2.1.2.4.3. Customer Provider</a></li>
<li><a class="reference internal" href="#an-odata-proxy">2.1.2.4.4. An OData Proxy</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="odatav2_consumer.html"
                        title="previous chapter">2.1.1. Data Consumers</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="odatav2_memexample.html"
                        title="next chapter">2.1.2.1. Sample Project: InMemory Data Service</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/odatav2_provider.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="odatav2_memexample.html" title="2.1.2.1. Sample Project: InMemory Data Service"
             >next</a> |</li>
        <li class="right" >
          <a href="odatav2_consumer.html" title="2.1.1. Data Consumers"
             >previous</a> |</li>
        <li><a href="index.html">Pyslet 0.4.20140511 documentation</a> &raquo;</li>
          <li><a href="general.html" >2. Supporting Standards</a> &raquo;</li>
          <li><a href="odatav2.html" >2.1. The Open Data Protocol (OData)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright ©2008-2014, Steve Lay.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.1.
    </div>
  </body>
</html>